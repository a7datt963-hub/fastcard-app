<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ù…ÙˆÙ‚Ø¹ Ø´Ø­Ù† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</title>
    <style>
      /* --- Ø£Ù„ÙˆØ§Ù† ÙˆØªØµÙ…ÙŠÙ… --- */
      * { margin:0; padding:0; box-sizing:border-box }
      body { font-family:Arial,Helvetica,sans-serif; background:#000; color:#fff; overflow-x:hidden }
      header { background:#111; padding:10px 20px; position:relative; text-align:center }
      header img { height:90px; width:auto; display:block; margin:0 auto }
      #ordersStatusBar { margin:8px auto 0; max-width:720px; padding:4px 8px; border-radius:6px; text-align:center; min-height:22px; display:none; overflow:hidden; white-space:normal; pointer-events:none }
      .status-line { color:#FFCB01; padding:2px 4px; margin:2px 0; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; font-weight:700; border-bottom:1px solid rgba(255,203,1,0.06); line-height:1.1 }
      .status-line:last-child { border-bottom:none }
      .menu { position:absolute; right:20px; font-size:28px; cursor:pointer; color:#FFCB01; top:50%; transform:translateY(-50%) }
      #personalNumberDisplay { position:absolute; left:20px; top:50%; transform:translateY(-50%); color:#FFCB01; font-weight:bold; font-size:13px }
      #notifBell { position:absolute; right:68px; top:50%; transform:translateY(-50%); font-size:22px; cursor:pointer; color:#FFCB01 }
      #notifBell .badge { background:#ff3b30; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; margin-left:6px; vertical-align:middle }
      #notifBell .badge.hidden { display:none }
      .notif-panel { position:fixed; top:70px; right:20px; width:360px; max-width:92%; background:#111; border:2px solid #FFCB01; border-radius:10px; padding:10px; z-index:1500; box-shadow:0 6px 30px rgba(0,0,0,0.6) }
      .notif-panel.hidden { display:none }
      .notif-panel .panel-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px }
      .notif-panel h4 { margin:0; color:#FFCB01 }
      .notif-panel .close-btn { cursor:pointer; color:#FFCB01; font-size:20px }
      .notif-list { max-height:360px; overflow:auto; padding-right:6px }
      .notif-item { border:1px solid rgba(255,203,1,0.06); padding:8px; border-radius:8px; margin-bottom:8px; background:#000; position:relative }
      .notif-item .time { font-size:12px; color:#999; margin-top:6px }
      .notif-item .remove { position:absolute; left:8px; top:6px; cursor:pointer; color:#ff6b6b }
      .notif-empty { color:#999; text-align:center; padding:20px }
      .notif-actions { display:flex; gap:8px; justify-content:space-between; margin-top:8px }
      .notif-actions .btn { background:#FFCB01; color:#000; padding:8px; border-radius:8px; cursor:pointer }
      #ordersStatusBarInNotif { margin-bottom:8px; display:none; max-height:120px; overflow:auto; border-bottom:1px dashed rgba(255,203,1,0.06); padding-bottom:8px }
      .sidebar { position:fixed; top:0; right:-100%; width:80%; max-width:300px; height:100%; background:#111; padding:20px; transition:0.28s; z-index:1000; overflow-y:auto; border-left:2px solid #222 }
      .sidebar.active { right:0 }
      .sidebar .close-btn { font-size:30px; color:#FFCB01; cursor:pointer; text-align:left }
      .sidebar a { display:block; color:#fff; text-decoration:none; margin:16px 0; font-size:18px }
      .sidebar a:hover { color:#FFCB01 }
      .sidebar .profile-area { display:flex; align-items:center; gap:10px; cursor:pointer; margin-bottom:12px }
      .sidebar .avatar { width:48px; height:48px; border-radius:50%; background:#222; display:flex; align-items:center; justify-content:center; font-size:20px; color:#FFCB01; border:2px solid #FFCB01; }
      .sidebar .profile-text { flex:1; overflow:hidden }
      .sidebar .profile-name { font-weight:700; color:#FFCB01; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
      .sidebar .profile-num { font-size:12px; color:#ccc; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
      .container { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:15px; padding:20px }
      .card { background:#111; border:2px solid #FFCB01; border-radius:12px; padding:20px; text-align:center; cursor:pointer; transition:.25s; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center }
      .card:hover { background:#FFCB01; color:#000 }
      .hidden { display:none }
      .form-box { background:#111; border:2px solid #FFCB01; border-radius:12px; padding:20px; margin:20px }
      select,input,button,textarea { width:100%; padding:10px; margin:10px 0; border-radius:8px; border:none; font-size:16px; background:#222; color:#fff }
      .button-option { background:#222; color:#FFCB01; border:2px solid #FFCB01; margin:5px 0; padding:10px; border-radius:8px; cursor:pointer; width:100%; text-align:center; font-weight:bold }
      .button-option:hover { background:#FFCB01; color:#000 }
      .button-option.selected { background:#FFCB01; color:#000 }
      button { background:#FFCB01; color:#000; font-weight:bold; cursor:pointer; border-radius:8px; padding:10px }
      .small-btn { display:inline-block; padding:8px 12px; border-radius:8px; background:#FFCB01; color:#000; cursor:pointer; margin-top:8px; text-align:center }
      .back-btn { display:block; margin:20px auto; background:#FFCB01; color:#000; padding:10px; border-radius:8px; text-align:center; font-weight:bold; cursor:pointer }
      .price-note { color:#FFCB01; font-weight:bold; margin:10px 0; font-size:14px; white-space:pre-line }
      .orders-list { padding:10px; margin:10px; background:#111; border-radius:10px; border:1px solid #333 }
      .order-item { padding:12px; border:2px solid #FFCB01; border-radius:8px; margin-bottom:10px; background:#111 }
      .orders-close { position:absolute; right:20px; top:80px; font-size:36px; cursor:pointer; color:#FFCB01; transform:none }
      .login-page { max-width:600px; margin:18px auto; padding:16px }
      .login-note { font-size:13px; color:#aaa; margin-top:6px; }
      @media(max-width:600px){
        header img { height:80px }
        .menu { font-size:24px }
        #personalNumberDisplay { font-size:12px; left:12px }
        .orders-close { font-size:30px; top:68px }
        .notif-panel { right:8px; left:8px }
      }
      button[disabled]{ opacity:.5; cursor:not-allowed }
      .small-muted { font-size:12px; color:#aaa; margin-top:6px }
      .error { color:#ff6b6b; font-size:13px }
      .field-row { display:flex; gap:10px; flex-wrap:wrap }
      .field-row input { flex:1 }
      .muted-small { font-size:13px; color:#aaa; margin-top:6px }
      .upload-status { font-size:13px; color:#aaa; margin-top:6px }
      /* Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø²Ù…Ø© (Ù…Ø·Ù„ÙˆØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„) */
      .hide-phone-input { display:none !important; }

      /* --- Loader ÙˆProducts grid --- */
      .loader { display:inline-block; padding:8px 12px; border-radius:999px; border:2px dashed rgba(255,255,255,0.08); color:#FFCB01 }
      .product-title { font-weight:700; display:block; margin-bottom:6px }
      .product-price { font-size:13px; color:#ccc }
    </style>
  </head>
  <body>
    <header>
      <img src="https://i.postimg.cc/W1Ysr3QG/image.png" alt="Logo">
      <div id="personalNumberDisplay">Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ: <span id="personalNum"></span></div>
      <div id="notifBell" title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª" onclick="toggleNotifPanel()">ğŸ””<span id="notifBadge" class="badge hidden">0</span></div>
      <div class="menu" onclick="toggleSidebar()">â˜°</div>
      <div id="ordersStatusBar" aria-live="polite" role="status" style="display:none"></div>
    </header>

    <div id="notifPanel" class="notif-panel hidden" aria-live="polite">
      <div class="panel-header">
        <h4>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
        <div>
          <span class="close-btn" onclick="closeNotifPanel()">Ã—</span>
        </div>
      </div>
      <div id="ordersStatusBarInNotif" aria-live="polite"></div>
      <div id="notifList" class="notif-list"></div>
      <div class="notif-actions">
        <div class="btn" onclick="goHomeFromNotif()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="btn" onclick="clearAllNotifForCurrent()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</div>
      </div>
    </div>

    <div class="sidebar" id="sidebar">
      <div class="close-btn" onclick="toggleSidebar()">Ã—</div>
      <div class="profile-area" id="sidebarProfile" onclick="openProfileFromSidebar()">
        <div class="avatar" id="sidebarAvatar">Ø£</div>
        <div class="profile-text">
          <div class="profile-name" id="sidebarName">Ø¶ÙŠÙ</div>
          <div class="profile-num" id="sidebarPersonalNum">--</div>
        </div>
      </div>
      <a href="#" onclick="showHome(); toggleSidebar(); return false;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#" onclick="navigateToOrders(); toggleSidebar(); return false;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
      <a href="#" onclick="toggleSidebar(); window.open('https://wa.me/79228576801','_blank'); return false;">Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…</a>
      <a href="#" onclick="showHelpPage(); toggleSidebar(); return false;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø©</a>
      <a href="#" onclick="showOffersPage(); toggleSidebar(); return false;">Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</a>
      <a href="https://chat.whatsapp.com/LvrWRUCqLOw4cxjPlnH33J?mode=ems_copy_t" target="_blank" rel="noopener noreferrer">Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆØ§ØªØ³Ø§Ø¨</a>
      <hr style="border:none;height:1px;background:#222;margin:12px 0">
      <a href="#" onclick="showGamesPage(); toggleSidebar(); return false;">Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</a>
      <a href="#" onclick="showAppsPage(); toggleSidebar(); return false;">Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</a>
    </div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="form-box login-page hidden">
      <h3 style="text-align:center;color:#FFCB01;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>

      <label>Ø¶Ø¹ Ø§Ù„Ø£Ø³Ù…</label>
      <input type="text" id="loginName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">

      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input type="email" id="loginEmail" placeholder="example@domain.com">

      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
      <div style="position:relative;">
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button id="loginTogglePwd" style="position:absolute;left:6px;top:10px;height:36px;width:80px;cursor:pointer;">Ø§Ø¸Ù‡Ø§Ø±</button>
      </div>

      <label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ</label>
      <input type="text" id="loginPhone" placeholder="Ù…Ø«Ø§Ù„: 0999xxxxxx">

      <label>Ø¶Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ù„ÙŠ ÙˆÙ„Ø¯Ù‡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</label>
      <input type="text" id="loginPersonalNumber" readonly>

      <div class="small-muted" style="margin-top:6px;">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù† ÙŠØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠ ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.
        ÙÙ‚Ø· Ù‚Ù… Ø¨ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø§ØµÙ„ÙŠØ© ÙÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« Ù…Ø´ÙƒÙ„Ø© Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ.
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
        <button id="doLoginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>

      <div id="loginError" class="error" style="display:none;"></div>
    </div>

    <!-- Ù…Ù„Ù Ø´Ø®ØµÙŠ -->
    <div id="profilePage" class="hidden">
      <div class="form-box login-box">
        <h3 style="text-align:center;color:#FFCB01;">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="profileName" readonly>
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="profileEmail" readonly>
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
        <input type="password" id="profilePassword" readonly>
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="text" id="profilePhone" readonly>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button id="requestEditBtn">Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ</button>
          <button id="confirmSaveBtn" class="hidden">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
          <div class="back-btn" onclick="returnFromProfile()">â¬… Ø±Ø¬ÙˆØ¹</div>
        </div>
        <div id="profileMsg" class="muted-small"></div>
      </div>
    </div>

    <!-- Ø¨Ù‚ÙŠØ© Ø§Ù„ØµÙØ­Ø§Øª -->
    <div id="homePage" class="hidden">
      <div class="container" id="productsGrid">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… -->
        <div class="card" onclick="showGamesPage()">Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
        <div class="card" onclick="showAppsPage()">Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</div>
      </div>
    </div>

    <div id="helpPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø©</h3>
        <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</label>
        <input type="text" id="helpPersonalField" readonly>
        <label>-Ø§Ø®ØªØ± Ù…Ø´ÙƒÙ„ØªÙ„Ùƒ-</label>
        <select id="helpIssueSelect">
          <option value="" disabled selected>-- Ø§Ø®ØªØ± Ù…Ø´ÙƒÙ„ØªÙ„Ùƒ --</option>
          <option value="Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">Ù„Ø§ Ø§Ø³ØªØ·Ø¹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
          <option value="Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆÙ„Ù… ÙŠÙØ±Ø§Ø¬Ø¹ Ø·Ù„Ø¨ÙŠ">Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆÙ„Ù… ÙŠÙØ±Ø§Ø¬Ø¹ Ø·Ù„Ø¨ÙŠ</option>
          <option value="ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ÙŠ Ù„ÙƒÙ† Ù„Ù… ÙŠØµÙ„Ù†ÙŠ Ø´ÙŠØ¡">ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ÙŠ Ù„ÙƒÙ† Ù„Ù… ÙŠØµÙ„Ù†ÙŠ Ø´ÙŠØ¡</option>
          <option value="Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ Ø§Ø±Ø³Ø§Ù„ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©">Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ Ø§Ø±Ø³Ø§Ù„ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©</option>
        </select>
        <label>Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="file" id="helpFileUpload" accept="image/*">
        <div class="upload-status" id="helpUploadStatus"></div>
        <input type="text" id="helpFileLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" readonly>
        <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
        <textarea id="helpDesc" rows="5" maxlength="100" placeholder="ØµÙÙ Ù…Ø´ÙƒÙ„ØªÙƒ ÙˆØ¶Ø¹ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:#*********"></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button id="helpSubmitBtn">Ø¥Ø±Ø³Ø§Ù„</button>
          <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹</div>
        </div>
      </div>
    </div>

    <div id="helpSuccessPage" class="hidden">
      <div class="form-box" style="text-align:center;">
        <h3>Ù„Ù‚Ø¯ ØªÙ… Ø±ÙØ¹ Ù…Ø´ÙƒÙ„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­</h3>
        <p>Ø§Ù†ØªØ¸Ø± Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ</p>
        <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <div id="gamesPage" class="hidden">
      <div class="form-box">
        <h3>Ø§Ø®ØªØ± Ù„Ø¹Ø¨ØªÙƒ</h3>
        <select id="gameSelect">
          <option value="">-- Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø© --</option>
          <option value="Ø£ÙƒÙˆØ§Ø¯ ÙØ±ÙŠ ÙØ§ÙŠØ±">Ø£ÙƒÙˆØ§Ø¯ ÙØ±ÙŠ ÙØ§ÙŠØ±</option>
          <option value="ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ">ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ</option>
          <option value="Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ">Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ</option>
          <option value="Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¨Ø¬ÙŠ">Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¨Ø¬ÙŠ</option>
          <option value="Ø¬ÙˆØ§ÙƒØ±">Ø¬ÙˆØ§ÙƒØ±</option>
        </select>
        <input type="text" id="personalField" readonly>
        <!-- ØªÙ… Ø§Ø²Ø§Ù„Ø© Ø­Ù‚Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø²Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
        <input type="text" id="idField" placeholder="Ø¶Ø¹ Ø§Ù„Ø§ÙŠØ¯ÙŠ" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        <div id="optionsContainer"></div>
        <div id="priceDisplay"></div>
        <button id="submitForm" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
        <div class="price-note" id="paymentNote">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø²Ù…Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</div>
        <div id="orderStatus" style="color:#0f0;font-weight:bold;text-align:center;margin-top:10px;"></div>
        <div style="text-align:center;">
          <button id="goOrdersBtn" class="small-btn hidden" onclick="navigateToOrders()">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
        <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <div id="appsPage" class="hidden">
      <div class="form-box">
        <h3>Ø§Ø®ØªØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
        <select id="appSelect">
          <option value="">-- Ø§Ø®ØªØ± ØªØ·Ø¨ÙŠÙ‚ --</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 1">ØªØ·Ø¨ÙŠÙ‚ 1</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 2">ØªØ·Ø¨ÙŠÙ‚ 2</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 3">ØªØ·Ø¨ÙŠÙ‚ 3</option>
        </select>
        <input type="text" id="appPersonalField" readonly>
        <input type="text" id="appIdField" placeholder="Ø¶Ø¹ Ø§Ù„Ø§ÙŠØ¯ÙŠ" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        <div id="optionsContainerApps"></div>
        <div id="priceDisplayApps"></div>
        <button id="appSubmitForm" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
        <div class="price-note" id="appPaymentNote">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©/Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</div>
        <div id="appOrderStatus" style="color:#0f0;font-weight:bold;text-align:center;margin-top:10px;"></div>
        <div style="text-align:center;">
          <button id="goOrdersBtnApp" class="small-btn hidden" onclick="navigateToOrders()">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
        <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ -->
    <div id="offersPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;color:#FFCB01;">Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</h3>
        <div id="offersList" style="min-height:120px;"></div>
        <div style="text-align:center;margin-top:10px;">
          <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        </div>
      </div>
    </div>

    <div id="paymentDetailsPage" class="hidden">
      <div class="form-box">
        <div class="back-btn" onclick="returnFromPaymentDetails()">â¬… Ø±Ø¬ÙˆØ¹</div>
        <h3 id="pdTitle" style="text-align:center;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</h3>
        <div id="pdContent">
          <div id="pdTopInfo" style="text-align:center;margin-bottom:10px;color:#FFCB01;font-weight:bold;"></div>
          <select id="pdCashSelect">
            <option value="">-- Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ --</option>
            <option value="sham">Ø´Ø§Ù… ÙƒØ§Ø´</option>
            <option value="syrtel">Ø³ÙŠØ±ØªÙŠÙ„ ÙƒØ§Ø´</option>
            <option value="mtn">MTN ÙƒØ§Ø´</option>
            <option value="hawala">Ø­ÙˆØ§Ù„Ø© Ù…Ø§Ù„ÙŠØ©</option>
          </select>
          <div style="position:relative; margin-bottom:10px;">
            <input type="text" id="pdCopyField" readonly style="width:100%;padding-right:80px;">
            <button type="button" id="pdCopyBtn" style="position:absolute;left:0;top:0;height:100%;width:70px;cursor:pointer;">Ù†Ø³Ø®</button>
          </div>
          <div style="text-align:center;margin-bottom:10px;">
            <button type="button" id="pdToggleQrBtn">Ø§Ø¸Ù‡Ø±/Ø§Ø®ÙÙ QR</button>
          </div>
          <div id="qrContainer" style="display:none;margin-top:10px;text-align:center;">
            <img id="qrImg" src="https://i.postimg.cc/vHYg2nK5/IMG.jpg" alt="QR Ø´Ø§Ù…" style="width:300px;height:auto;">
          </div>
          <div id="syrtelQrContainer" style="display:none;margin-top:10px;text-align:center;">
            <img id="syrtelQrImg" src="https://i.postimg.cc/tT6ScwYv/IMG.jpg" alt="QR Ø³ÙŠØ±ÙŠØªÙŠÙ„" style="width:300px;height:auto;">
          </div>

          <div id="shamFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>ØªØ­ÙˆÙŠÙ„ Ø´Ø§Ù… ÙƒØ§Ø´ Ø¥Ù„Ù‰:</strong>
              <div style="margin-top:6px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„Ù…Ø­ÙØ¸Ø©: <span id="shamAddressDisplay">e5eca798a4add8f1b86d389330131c82</span></div>
            </div>
          </div>

          <div id="syrtelFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>ØªØ­ÙˆÙŠÙ„ Ø³ÙŠØ±ØªÙŠÙ„ ÙƒØ§Ø´ Ø¥Ù„Ù‰:</strong>
              <div style="margin-top:6px;">Ø§Ù„Ø±Ù‚Ù…: <span id="syrtelAddressDisplay">72289118</span></div>
            </div>
          </div>

          <div id="hawalaFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ:</strong>
              <div style="margin-top:8px;">Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ø­Ù…Ø¯ Ø¹ØªÙˆÙ†</div>
              <div class="muted-small" style="margin-top:8px;color:#ccc;">
                Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙŠØªÙ… Ø¹Ø¨Ø± Ù…ÙƒØ§ØªØ¨ Ø§Ù„ØµØ±Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø³ÙˆØ±ÙŠØ§ Ù…Ø«Ù„: Ø§Ù„Ù‡Ø±Ù…ØŒ Ø§Ù„ÙØ¤Ø§Ø¯ØŒ Ø¯ÙˆÙÙŠØ²ØŒ Ø§Ù„Ø®...
              </div>
            </div>
          </div>

          <input type="file" id="paymentFileUpload" accept="image/*">
          <div class="upload-status" id="paymentUploadStatus"></div>
          <input type="text" id="paymentFileLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§" readonly>
          <div id="pdPriceInfo" style="color:#0f0;font-weight:bold;margin-top:10px;text-align:center"></div>
          <div class="price-note" id="pdNote" style="white-space:pre-line">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</div>
          <button id="pdSubmitForm">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>
    </div>

    <div id="reviewPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;color:#FFCB01;">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
        <p id="reviewMsg" style="text-align:center;margin-top:10px;color:#fff;">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
        <div style="text-align:center;margin-top:15px;">
          <button class="review-go-orders" onclick="navigateToOrders()">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
        <div style="text-align:center;margin-top:12px;">
          <button class="back-btn" onclick="goHome()">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
      </div>
    </div>

    <div id="ordersPage" class="hidden">
      <div class="form-box" style="position:relative;">
        <div class="orders-close" onclick="returnFromOrders()">Ã—</div>
        <h3 style="text-align:center">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <div id="ordersList" class="orders-list"></div>
        <div class="back-btn" onclick="showHome()">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <script>
      // ---------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (ØªØ¹Ø¯ÙŠÙ„Øª Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø·Ù„Ø¨) ----------
      const botToken = "8484157462:AAGHyBqwL9k1EmzvXAIZkb9UNDcwIGMINAs"; // Ø¨ÙˆØª Ø§Ù„Ø¯ÙØ¹/Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (ÙƒÙ…Ø§ ÙƒØ§Ù†)
      const chat_id = "7649409589";
      const personalBotToken = "7867503081:AAE32J-TrMh52QYHrbPzsKxnM7qbgA9iKCo"; // Ø¨ÙˆØª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© - Ù…Ø­Ø¯Ø« ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
      const loginReportBotToken = "8322394934:AAFik8dEU71oOxBCHlhOVNKFGATWnqlg-_8"; // ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ù…ÙˆØ¬ÙˆØ¯)
      const loginReportChatId = "7649409589";
      const IMGBB_API_KEY = "e5603dfd5675ed2b5a671577abcf6d33"; // Ù…ÙØªØ§Ø­ imgbb Ø§Ù„Ø°ÙŠ Ø²ÙˆØ¯ØªÙ†ÙŠ Ø¨Ù‡
      // Ø¨ÙˆØª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (ØªÙ… Ø·Ù„Ø¨Ù‡ Ø®ØµÙŠØµÙ‹Ø§)
      const helpBotToken = "8242410438:AAHtm6-aIldfmTe1JQVnhdYkOIY3MaN4aFA";
      const helpBotChatId = "7649409589";
      // Ø¨ÙˆØª Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ (Ù„Ø¥Ø±Ø³Ø§Ù„/Ø§Ù„ØªØ­Ù‚Ù‚)
      const offersBotToken = "7976416746:AAGyvWAxanxhkz--4c6U_3-NA2TGBV4lJ9Y";
      const offersBotChatId = "7649409589";

      const PERSONAL_LAST_UPDATE_KEY = "personal_tg_last_update_id_v1";
      const PROFILE_KEY = "user_profile_v1";
      const LOGIN_REPORT_LAST_UPDATE_KEY = "login_report_tg_last_update_id_v1";
      const PROFILE_EDIT_REQUESTS_KEY = "profile_edit_requests_v1";

      let previousPageId = null;
      let previousBeforePayment = null;

      // Ø±Ù‚Ù… Ø´Ø®ØµÙŠ
      let personalNumber = localStorage.getItem("personalNumber");
      if(!personalNumber){
        personalNumber = Math.floor(1000000 + Math.random()*9000000);
        localStorage.setItem("personalNumber", personalNumber);
      }

      // load/save profile helpers
      function loadProfile(){ try{ const raw = localStorage.getItem(PROFILE_KEY); return raw ? JSON.parse(raw) : null; }catch(e){ return null; } }
      function saveProfile(profile){ try{ localStorage.setItem(PROFILE_KEY, JSON.stringify(profile||{})); }catch(e){} }

      function loadProfileEditRequests(){ try{ const raw = localStorage.getItem(PROFILE_EDIT_REQUESTS_KEY); return raw?JSON.parse(raw):{} }catch(e){ return {}; } }
      function saveProfileEditRequests(obj){ try{ localStorage.setItem(PROFILE_EDIT_REQUESTS_KEY, JSON.stringify(obj)); }catch(e){} }

      // helper: blocked numbers management (Ø­Ø¸Ø± Ù…Ø­Ù„ÙŠ)
      function loadBlockedNumbers(){ try{ return JSON.parse(localStorage.getItem('blocked_personal_numbers_v1')||'[]'); }catch(e){ return []; } }
      function saveBlockedNumbers(arr){ try{ localStorage.setItem('blocked_personal_numbers_v1', JSON.stringify(arr||[])); }catch(e){} }
      function isBlockedPersonal(p){ const list=loadBlockedNumbers(); return list.map(String).includes(String(p)); }
      function blockPersonalNumber(p){ const list=loadBlockedNumbers(); if(!list.map(String).includes(String(p))){ list.push(String(p)); saveBlockedNumbers(list); } }
      function unblockPersonalNumber(p){ let list=loadBlockedNumbers(); list=list.filter(x=>String(x)!==String(p)); saveBlockedNumbers(list); }

      function ensureNotBlocked(){
        if(isBlockedPersonal(personalNumber)){
          alert('ØªÙ… Ø­Ø¸Ø± Ø­Ø³Ø§Ø¨Ùƒ');
          showLoginPage();
          return false;
        }
        return true;
      }

      // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø£ÙˆÙ„ÙŠØ©
      document.getElementById("personalNum").textContent = personalNumber;
      document.getElementById("personalField").value = personalNumber;
      document.getElementById("appPersonalField").value = personalNumber;
      document.getElementById("helpPersonalField").value = personalNumber;
      document.getElementById("loginPersonalNumber").value = personalNumber;
      document.getElementById("sidebarPersonalNum").textContent = "Ø±Ù‚Ù…: " + personalNumber;

      function updateSidebarProfileDisplay(){
        const prof = loadProfile();
        const nameEl = document.getElementById("sidebarName");
        const avatarEl = document.getElementById("sidebarAvatar");
        const displayName = (prof && prof.name) ? prof.name : "Ø¶ÙŠÙ";
        nameEl.textContent = displayName;
        avatarEl.textContent = displayName && displayName.trim().length>0 ? displayName.trim().charAt(0).toUpperCase() : "Ø£";
      }
      updateSidebarProfileDisplay();

      // Ø§Ù„ØªÙ†Ù‚Ù„
      function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("active"); }
      function hideAllPages(){ ["homePage","gamesPage","appsPage","ordersPage","paymentDetailsPage","reviewPage","helpPage","helpSuccessPage","profilePage","loginPage","offersPage"].forEach(id=>{ const el=document.getElementById(id); if(el) el.classList.add("hidden"); }); }
      function showHome(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("homePage").classList.remove("hidden"); fetchProducts(); }
      function goHome(){ showHome(); window.scrollTo({top:0,behavior:'smooth'}); }
      function showGamesPage(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("gamesPage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showAppsPage(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("appsPage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showHelpPage(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("helpPage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showHelpSuccessPage(){ hideAllPages(); document.getElementById("helpSuccessPage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showProfilePage(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("profilePage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showLoginPage(){ hideAllPages(); document.getElementById("loginPage").classList.remove("hidden"); window.scrollTo({top:0,behavior:'smooth'}); }
      function showOffersPage(){ if(!ensureNotBlocked()) return; hideAllPages(); document.getElementById("offersPage").classList.remove("hidden"); renderOffers(); window.scrollTo({top:0,behavior:'smooth'}); }

      function getCurrentPageId(){ const ids=["homePage","gamesPage","appsPage","ordersPage","paymentDetailsPage","reviewPage","helpPage","helpSuccessPage","profilePage","loginPage","offersPage"]; for(const id of ids) if(!document.getElementById(id).classList.contains('hidden')) return id; return "homePage"; }
      function navigateToOrders(){ previousPageId = getCurrentPageId(); hideAllPages(); document.getElementById("ordersPage").classList.remove("hidden"); renderOrders(); window.scrollTo({top:0,behavior:'smooth'}); }
      function returnFromOrders(){ if(previousPageId && document.getElementById(previousPageId)){ hideAllPages(); document.getElementById(previousPageId).classList.remove('hidden'); } else showHome(); }
      function returnFromPaymentDetails(){ if(previousBeforePayment && document.getElementById(previousBeforePayment)){ hideAllPages(); document.getElementById(previousBeforePayment).classList.remove('hidden'); } else showHome(); }

      function openProfileFromSidebar(){ toggleSidebar(); const prof = loadProfile() || {}; document.getElementById("profileName").value = prof.name || ""; document.getElementById("profileEmail").value = prof.email || ""; document.getElementById("profilePassword").value = prof.password || ""; document.getElementById("profilePhone").value = prof.phone || ""; applyProfileEditState(); document.getElementById("profileError")?.setAttribute('style','display:none;'); showProfilePage(); }
      function returnFromProfile(){ if(previousPageId && document.getElementById(previousPageId)){ hideAllPages(); document.getElementById(previousPageId).classList.remove('hidden'); } else showHome(); }

      // toggle pwd
      document.getElementById("loginTogglePwd").addEventListener("click", function(){ const inp = document.getElementById("loginPassword"); if(inp.type === 'password'){ inp.type='text'; this.textContent = 'Ø§Ø®ÙÙ'; } else { inp.type='password'; this.textContent = 'Ø§Ø¸Ù‡Ø§Ø±'; } });

      // ØªØ³Ø¬ÙŠÙ„ / Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ø´Ø§Ù…Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±)
      document.getElementById("doLoginBtn").addEventListener("click", async function(){
        const name = (document.getElementById("loginName").value || "").trim();
        const email = (document.getElementById("loginEmail").value || "").trim();
        const password = (document.getElementById("loginPassword").value || "");
        const phone = (document.getElementById("loginPhone").value || "").trim();
        const personal = document.getElementById("loginPersonalNumber").value || personalNumber;
        const errEl = document.getElementById("loginError");
        errEl.style.display = 'none'; errEl.textContent = '';

        if(!name){ errEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…'; errEl.style.display='block'; return; }
        if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ errEl.textContent = 'ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'; errEl.style.display='block'; return; }
        if(!password){ errEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±'; errEl.style.display='block'; return; }
        if(phone && !/^[0-9\+\-\s]{6,20}$/.test(phone)){ errEl.textContent = 'ØµÙŠØºØ© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'; errEl.style.display='block'; return; }

        const profile = { name, email, password, phone, personalNumber: String(personal), canEdit:false };
        saveProfile(profile);
        updateSidebarProfileDisplay();

        const msg = `ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯:\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\nØ§Ù„Ù‡Ø§ØªÙ: ${phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\nØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ: ${personal}\nÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: ${password}`;

        try{
          await fetch(`https://api.telegram.org/bot${loginReportBotToken}/sendMessage`, {
            method: "POST",
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ chat_id: loginReportChatId, text: msg })
          });
        }catch(e){
          console.warn("login report send error", e);
        }

        // Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        showHome();
        document.getElementById("personalNum").textContent = personal;
        document.getElementById("personalField").value = personal;
        document.getElementById("appPersonalField").value = personal;
        document.getElementById("helpPersonalField").value = personal;
      });

      function applyProfileEditState(){
        const prof = loadProfile() || {};
        const canEdit = !!prof.canEdit;
        const fields = ["profileName","profileEmail","profilePassword","profilePhone"];
        fields.forEach(id=>{
          const el = document.getElementById(id);
          if(!el) return;
          if(canEdit){ el.removeAttribute("readonly"); el.style.background="#222"; } else { el.setAttribute("readonly","readonly"); el.style.background="#222"; }
        });
        const reqBtn = document.getElementById("requestEditBtn");
        const saveBtn = document.getElementById("confirmSaveBtn");
        const msgEl = document.getElementById("profileMsg");
        msgEl.textContent = '';
        if(canEdit){
          reqBtn.classList.add("hidden");
          saveBtn.classList.remove("hidden");
          msgEl.textContent = 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø¢Ù† Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸.';
        } else {
          reqBtn.classList.remove("hidden");
          saveBtn.classList.add("hidden");
          msgEl.textContent = 'Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡.';
        }
      }

      // Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ -> Ø§Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ­ÙØ¸ map message_id => personal
      document.getElementById("requestEditBtn").addEventListener("click", async function(){
        if(!ensureNotBlocked()) return;
        const prof = loadProfile() || {};
        const name = prof.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const personal = prof.personalNumber || personalNumber;
        const msgText = `Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ: ${personal}\n(Ø§ÙƒØªØ¨ "ØªÙ…" ÙƒØ±Ø¯ Ù‡Ù†Ø§ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)`;
        try{
          const res = await fetch(`https://api.telegram.org/bot${loginReportBotToken}/sendMessage`, {
            method: "POST",
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ chat_id: loginReportChatId, text: msgText })
          });
          const data = await res.json();
          if(data && data.ok && data.result && data.result.message_id){
            const msgId = String(data.result.message_id);
            const map = loadProfileEditRequests();
            map[msgId] = String(personal);
            saveProfileEditRequests(map);
            this.textContent = 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ - Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©';
            this.disabled = true;
            setTimeout(()=>{ this.textContent = 'Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ'; this.disabled = false; }, 12000);
          } else {
            alert('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
          }
        }catch(e){
          console.warn("request edit send error", e);
          alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.');
        }
      });

      document.getElementById("confirmSaveBtn").addEventListener("click", function(){
        const prof = loadProfile() || {};
        if(!prof.canEdit){ alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¥Ø°Ù† Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†.'); return; }
        const name = (document.getElementById("profileName").value || "").trim();
        const email = (document.getElementById("profileEmail").value || "").trim();
        const password = (document.getElementById("profilePassword").value || "");
        const phone = (document.getElementById("profilePhone").value || "").trim();
        if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ alert('ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); return; }
        if(phone && !/^[0-9\+\-\s]{6,20}$/.test(phone)){ alert('ØµÙŠØºØ© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); return; }
        const updated = Object.assign({}, prof, { name, email, password, phone, canEdit: false });
        saveProfile(updated);
        updateSidebarProfileDisplay();
        applyProfileEditState();
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª. Ù„Ù† ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯.');
      });

      // ===================== Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ imgbb =====================
      function uploadToImgbbXHR(file, onProgress){
        return new Promise((resolve, reject) => {
          if(!file) return reject(new Error("No file provided"));
          if(!file.type || !file.type.startsWith("image/")) return reject(new Error("Ø§Ù„Ù…Ù„Ù Ù„ÙŠØ³ ØµÙˆØ±Ø©"));
          const MAX = 15 * 1024 * 1024; // 15MB
          if(file.size > MAX) return reject(new Error("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ØŒØ±Ø¬Ø§Ø¡ Ø§Ø®ØªØ± Ù…Ù„Ù Ø£ØµØºØ± Ù…Ù† 15 Ù…ÙŠØºØ§Ø¨Ø§ÙŠØª"));

          const url = `https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`;
          const fd = new FormData();
          fd.append('image', file);

          const xhr = new XMLHttpRequest();
          xhr.open('POST', url);
          xhr.timeout = 120000;
          xhr.onload = function(){
            if(xhr.status >= 200 && xhr.status < 300){
              try{
                const resp = JSON.parse(xhr.responseText || "{}");
                if(resp && resp.data && (resp.data.url || resp.data.display_url)){
                  resolve(resp.data.url || resp.data.display_url);
                } else {
                  reject(new Error("Ø§Ø³ØªØ¬Ø§Ø¨Ø© imgbb ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©: " + xhr.responseText));
                }
              }catch(e){
                reject(new Error("ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© imgbb: " + e.message));
              }
            } else {
              reject(new Error("Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: " + xhr.status + " - " + xhr.statusText + " -- " + xhr.responseText));
            }
          };
          xhr.onerror = function(){ reject(new Error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹")); };
          xhr.ontimeout = function(){ reject(new Error("Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹")); };
          if(xhr.upload && typeof onProgress === 'function'){
            xhr.upload.onprogress = function(ev){
              if(ev.lengthComputable){
                const pct = Math.round((ev.loaded/ev.total)*100);
                onProgress && onProgress(pct, ev.loaded, ev.total);
              }
            };
          }
          try{ xhr.send(fd); }catch(e){ reject(e); }
        });
      }

      async function uploadToImgbbFallbackBase64(file, onProgress){
        try{
          const base64 = await new Promise((resolve, reject)=>{
            const r = new FileReader();
            r.onload = ()=> {
              const data = String(r.result || "");
              const parts = data.split(',');
              resolve(parts.length>1 ? parts[1] : parts[0]);
            };
            r.onerror = ()=> reject(new Error("ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ base64"));
            r.readAsDataURL(file);
          });
          const formData = new FormData();
          formData.append('image', base64);
          const resp = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method:'POST', body: formData });
          const data = await resp.json();
          if(data && data.data && (data.data.url || data.data.display_url)) return data.data.url || data.data.display_url;
          throw new Error("Fallback response ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹");
        }catch(e){ throw e; }
      }

      async function uploadToImgbb(file, onProgress){
        try{ return await uploadToImgbbXHR(file, onProgress); }catch(err){
          console.warn("XHR upload failed, trying base64 fallback:", err);
          try{ return await uploadToImgbbFallbackBase64(file, onProgress); }catch(err2){ console.error("Both upload methods failed:", err, err2); throw err2; }
        }
      }

      // Ù…Ø³ØªÙ…Ø¹ Ø±ÙØ¹ Ù…Ù„Ù Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
      document.getElementById("paymentFileUpload")?.addEventListener("change", async function(){
        if(!ensureNotBlocked()) return;
        const file = this.files[0];
        const linkEl = document.getElementById("paymentFileLink");
        const statusEl = document.getElementById("paymentUploadStatus");
        if(!file){ if(linkEl) linkEl.value=""; if(statusEl) statusEl.textContent=""; return; }
        if(linkEl) linkEl.value = "";
        if(statusEl) statusEl.textContent = "Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... 0%";
        try{
          const url = await uploadToImgbb(file, (pct)=>{ if(statusEl) statusEl.textContent = `Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... ${pct}%`; });
          if(url){
            if(linkEl) linkEl.value = url;
            if(statusEl) statusEl.textContent = "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­";
            alert("ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­");
          } else {
            if(statusEl) statusEl.textContent = "ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù";
            if(linkEl) linkEl.value = "";
            alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
          }
        }catch(e){
          if(statusEl) statusEl.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹: " + (e && e.message ? e.message : e);
          if(linkEl) linkEl.value = "";
          console.error("paymentFileUpload error", e);
          alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: " + (e && e.message ? e.message : "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
      });

      // Ù…Ø³ØªÙ…Ø¹ Ø±ÙØ¹ Ù…Ù„Ù Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
      document.getElementById("helpFileUpload")?.addEventListener("change", async function(){
        if(!ensureNotBlocked()) return;
        const file = this.files[0];
        const linkEl = document.getElementById("helpFileLink");
        const statusEl = document.getElementById("helpUploadStatus");
        if(!file){ if(linkEl) linkEl.value=""; if(statusEl) statusEl.textContent=""; return; }
        if(linkEl) linkEl.value = "";
        if(statusEl) statusEl.textContent = "Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... 0%";
        try{
          const url = await uploadToImgbb(file, (pct)=>{ if(statusEl) statusEl.textContent = `Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... ${pct}%`; });
          if(url){
            if(linkEl) linkEl.value = url;
            if(statusEl) statusEl.textContent = "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­";
            alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­");
          } else {
            if(statusEl) statusEl.textContent = "ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù";
            if(linkEl) linkEl.value = "";
            alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
          }
        }catch(e){
          if(statusEl) statusEl.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹: " + (e && e.message ? e.message : e);
          if(linkEl) linkEl.value = "";
          console.error("helpFileUpload error", e);
          alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: " + (e && e.message ? e.message : "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
      });

      // Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ (Ø£Ø³Ø¹Ø§Ø±ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§ØªØŒ Ø¥Ø±Ø³Ø§Ù„ ØªÙ„ØºØ±Ø§Ù…...) ----------------------------
      const priceMapFF={"100 Ø¬ÙˆØ§Ù‡Ø±":"12500 Ù„.Ø³","200 Ø¬ÙˆØ§Ù‡Ø±":"25000 Ù„.Ø³","300 Ø¬ÙˆØ§Ù‡Ø±":"60000 Ù„.Ø³","530 Ø¬ÙˆØ§Ù‡Ø±":"60000 Ù„.Ø³","1080 Ø¬ÙˆØ§Ù‡Ø±":"120000 Ù„.Ø³","2200 Ø¬ÙˆØ§Ù‡Ø±":"240000 Ù„.Ø³","Ø¹Ø¶ÙˆÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©":"30000 Ù„.Ø³","Ø¹Ø¶ÙˆÙŠØ© Ø´Ù‡Ø±ÙŠØ©":"140000 Ù„.Ø³"};
      const priceMapPUBG={"60 Ø´Ø¯Ø©":"6000 Ù„.Ø³","325 Ø´Ø¯Ø©":"25000 Ù„.Ø³","660 Ø´Ø¯Ø©":"48000 Ù„.Ø³","1800 Ø´Ø¯Ø©":"120000 Ù„.Ø³","3850 Ø´Ø¯Ø©":"240000 Ù„.Ø³","8100 Ø´Ø¯Ø©":"480000 Ù„.Ø³"};
      const priceMapjwa = priceMapPUBG;
      const priceMappubg1={"ÙƒÙˆØ¯ 60 Ø´Ø¯Ù‡":"12500 Ù„.Ø³"};
      const priceMapApps = {"ØªØ·Ø¨ÙŠÙ‚ 1":"5000 Ù„.Ø³","ØªØ·Ø¨ÙŠÙ‚ 2":"10000 Ù„.Ø³","ØªØ·Ø¨ÙŠÙ‚ 3":"15000 Ù„.Ø³"};

      const optionsContainer = document.getElementById("optionsContainer");
      const optionsContainerApps = document.getElementById("optionsContainerApps");
      let selectedGameOption = "";
      let selectedAppOption = "";
      let currentMap = null;

      const submitBtn = document.getElementById('submitForm');
      const appSubmitBtn = document.getElementById('appSubmitForm');

      function getProfilePhoneOrAsk(){
        const prof = loadProfile();
        if(prof && prof.phone) return prof.phone;
        const entered = prompt("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨:") || "";
        if(entered && /^[0-9\+\-\s]{6,20}$/.test(entered)){
          // Ù†Ø®Ø²Ù† Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø­ØªÙ‰ Ù„Ø§ ÙŠØ·Ù„Ø¨ ÙƒÙ„ Ù…Ø±Ø©
          const p = loadProfile() || {};
          p.phone = entered;
          saveProfile(p);
          updateSidebarProfileDisplay();
          return entered;
        }
        return "";
      }

      function updateSubmitButtonGames(){ const idf=document.getElementById('idField').value.trim(); submitBtn.disabled = !(selectedGameOption && idf); }
      function updateSubmitButtonApps(){ const idf=document.getElementById('appIdField').value.trim(); appSubmitBtn.disabled = !(selectedAppOption && idf); }

      document.getElementById('idField').addEventListener('input', updateSubmitButtonGames);
      document.getElementById('appIdField').addEventListener('input', updateSubmitButtonApps);

      document.getElementById("gameSelect").addEventListener("change", function(){
        optionsContainer.innerHTML=""; selectedGameOption=""; document.getElementById("priceDisplay").textContent="";
        const val=this.value;
        if(val==="ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ") currentMap=priceMapFF;
        else if(val==="Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ") currentMap=priceMapPUBG;
        else if(val==="Ø¬ÙˆØ§ÙƒØ±") currentMap=priceMapjwa;
        else if(val==="Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¨Ø¬ÙŠ") currentMap=priceMappubg1;
        else currentMap=null;
        if(currentMap){
          Object.keys(currentMap).forEach(opt=>{
            const btn=document.createElement("div");
            btn.className="button-option";
            btn.textContent=opt;
            btn.onclick=function(){
              document.querySelectorAll("#optionsContainer .button-option").forEach(b=>b.classList.remove("selected"));
              btn.classList.add("selected");
              selectedGameOption=opt;
              document.getElementById("priceDisplay").textContent = `Ø§Ù„Ø­Ø²Ù…Ø©: ${opt}\nØ§Ù„Ø³Ø¹Ø±: ${currentMap[opt]}`;
              document.getElementById("priceDisplay").style.color="#0f0";
              updateSubmitButtonGames();
            };
            optionsContainer.appendChild(btn);
          });
        }
      });

      document.getElementById("appSelect").addEventListener("change", function(){
        optionsContainerApps.innerHTML=""; selectedAppOption=""; document.getElementById("priceDisplayApps").textContent="";
        const app=this.value;
        if(priceMapApps[app]){
          const btn=document.createElement("div");
          btn.className="button-option";
          btn.textContent=app;
          btn.onclick=function(){
            document.querySelectorAll("#optionsContainerApps .button-option").forEach(b=>b.classList.remove("selected"));
            btn.classList.add("selected");
            selectedAppOption=app;
            document.getElementById("priceDisplayApps").textContent = `Ø§Ù„Ø³Ø¹Ø±: ${priceMapApps[app]}`;
            document.getElementById("priceDisplayApps").style.color="#0f0";
            updateSubmitButtonApps();
          };
          optionsContainerApps.appendChild(btn);
        }
      });

      submitBtn.addEventListener('click', function(){
        if(!ensureNotBlocked()) return;
        const idField=document.getElementById('idField').value.trim();
        const game=document.getElementById('gameSelect').value;
        if(!game||!idField||!selectedGameOption){ alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø£Ùˆ Ø§Ø³Ø£Ù„Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹
        showPaymentDetailsFromSubmit('gamesPage');
      });

      appSubmitBtn.addEventListener('click', function(){
        if(!ensureNotBlocked()) return;
        const app=document.getElementById('appSelect').value;
        const idField=document.getElementById('appIdField').value.trim();
        if(!app||!idField||!selectedAppOption){alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');return;}
        showPaymentDetailsFromSubmit('appsPage');
      });

      function mapPaymentName(code){ const m={sham:'Ø´Ø§Ù… ÙƒØ§Ø´',syrtel:'Ø³ÙŠØ±ØªÙŠÙ„ ÙƒØ§Ø´',mtn:'MTN ÙƒØ§Ø´',hawala:'Ø­ÙˆØ§Ù„Ø© Ù…Ø§Ù„ÙŠØ©'}; return m[code]||code; }

      // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (localStorage) =====
      function loadOrders(){ const raw=localStorage.getItem("orders_v1"); return raw?JSON.parse(raw):[]; }
      function saveOrders(list){ localStorage.setItem("orders_v1", JSON.stringify(list)); }
      function addOrder(order){ const list=loadOrders(); list.unshift(order); saveOrders(list); renderOrders(); renderRepliedStatuses(true); }
      function getOrderById(id){ const list=loadOrders(); return list.find(o=>String(o.id)===String(id))||null; }
      function updateOrderInStorage(order){ const list=loadOrders(); const idx=list.findIndex(o=>String(o.id)===String(order.id)); if(idx!==-1){ list[idx]=order; saveOrders(list); renderOrders(); } }

      function renderOrders(){
        const list = loadOrders();
        const container = document.getElementById("ordersList");
        container.innerHTML = "";
        if(list.length===0){ container.innerHTML = "<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>"; return; }
        list.forEach(o=>{
          const d = document.createElement("div"); d.className="order-item";
          let time=""; try{ time = new Date(o.createdAt).toLocaleString(); }catch(e){ time = o.createdAt; }
          d.innerHTML = `<strong>#${o.id}</strong> - ${o.type} - ${o.item || ''} <br>     Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone} - Ø§Ù„Ø§ÙŠØ¯ÙŠ: ${o.idField || ''} <br>     Ø§Ù„ÙˆÙ‚Øª: ${time} <br>     Ø§Ù„Ø­Ø§Ù„Ø©: <strong id="status_${o.id}">${o.status}</strong>`;
          container.appendChild(d);
        });
      }

      function updateOrderStatusDisplays(orderId, status){
        const el = document.getElementById("status_"+orderId);
        if(el) el.textContent = status;
        const lastId = localStorage.getItem("lastOrderId");
        if(String(lastId) === String(orderId)){
          const os = document.getElementById("orderStatus");
          const aos = document.getElementById("appOrderStatus");
          if(os) os.textContent = status;
          if(aos) aos.textContent = status;
        }
      }

      // Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      let ordersStatusBarTimeout = null;
      const ORDERS_BAR_SHOWN_KEY = "orders_bar_shown_ids_v1";
      function getShownIds(){ try{ const raw = localStorage.getItem(ORDERS_BAR_SHOWN_KEY); return raw ? JSON.parse(raw) : []; }catch(e){ return []; } }
      function markIdsAsShown(ids){ const cur = getShownIds(); const set = new Set(cur.map(String)); ids.forEach(id=>set.add(String(id))); const arr = Array.from(set); localStorage.setItem(ORDERS_BAR_SHOWN_KEY, JSON.stringify(arr)); }

      function addOrderNotifToPanel(orderId, statusText, itemText, personalNum){
        try{
          const panelBar = document.getElementById("ordersStatusBarInNotif");
          const newLineText = `${statusText} â€” ${itemText || ''} â€” #${orderId}`;
          if(panelBar.childNodes){
            for(const ch of Array.from(panelBar.childNodes)){
              if(ch.textContent && ch.textContent.trim() === newLineText.trim()){ return; }
            }
          }
          const line = document.createElement("div");
          line.className = "status-line";
          line.textContent = newLineText;
          if(panelBar.firstChild) panelBar.insertBefore(line, panelBar.firstChild);
          else panelBar.appendChild(line);
          panelBar.style.display = 'block';
          if(personalNum){ addPersonalMessageForNumber(personalNum, newLineText, new Date().toISOString()); }
          markIdsAsShown([orderId]);
        }catch(e){ console.warn("addOrderNotifToPanel error", e); }
      }

      function flashStatusBar(orderId, status){
        const order = getOrderById(orderId);
        const itemText = order ? order.item : '';
        const personalNum = order ? (order.personalNumber || null) : null;
        const s = (status || "").toLowerCase();
        let displayText = status;
        if(s.includes('ØªÙ…') || s.includes('Ù…Ù‚Ø¨ÙˆÙ„') || s.includes('accept') || s.includes('Ù‚Ø¨ÙˆÙ„')) displayText = `ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ`;
        else if(s.includes('Ø±ÙØ¶') || s.includes('Ù…Ø±ÙÙˆØ¶') || s.includes('reject')) displayText = `ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ`;
        else if(s.includes('Ø§Ù„Ø±ØµÙŠØ¯')|| s.includes('Ø±ØµÙŠØ¯')) displayText = `Ù„Ù… ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨`;
        addOrderNotifToPanel(orderId, displayText, itemText, personalNum);
        const hdrBar = document.getElementById("ordersStatusBar");
        if(hdrBar){
          hdrBar.innerHTML = "";
          const line = document.createElement("div");
          line.className = "status-line";
          line.textContent = `${displayText} â€” ${itemText || ''} â€” #${orderId}`; hdrBar.appendChild(line);
          hdrBar.style.display = 'none';
          if(ordersStatusBarTimeout) clearTimeout(ordersStatusBarTimeout);
          ordersStatusBarTimeout = setTimeout(()=>{ hdrBar.style.display = 'none'; }, 20000);
        }
      }

      function renderRepliedStatuses(showTemporarily=false){
        const panelBar = document.getElementById("ordersStatusBarInNotif");
        panelBar.innerHTML = "";
        const list = loadOrders();
        const replied = list.filter(o => o.replied);
        if(replied.length===0){ panelBar.style.display='none'; return; }
        const shownIds = getShownIds().map(String);
        const unseen = replied.filter(o => !shownIds.includes(String(o.id)));
        if(unseen.length === 0){ panelBar.style.display = 'none'; return; }
        const latestNew = unseen.slice(0,3);
        latestNew.forEach(o=>{
          const s = (o.status || "").toLowerCase();
          let displayText = o.status;
          if(s.includes('ØªÙ…') || s.includes('Ù…Ù‚Ø¨ÙˆÙ„') || s.includes('accept') || s.includes('Ù‚Ø¨ÙˆÙ„')) displayText = `ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ`;
          else if(s.includes('Ø±ÙØ¶') || s.includes('Ù…Ø±ÙÙˆØ¶') || s.includes('reject')) displayText = `ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ`;
          else displayText = o.status;
          const line = document.createElement("div");
          line.className = "status-line";
          line.textContent = `${displayText} â€” ${o.item || ''} â€” #${o.id}`;
          panelBar.appendChild(line);
          if(o.personalNumber) addPersonalMessageForNumber(o.personalNumber, `${displayText} â€” ${o.item || ''} â€” #${o.id}`, new Date().toISOString());
        });
        markIdsAsShown(latestNew.map(x=>x.id));
        panelBar.style.display = 'block';
        if(showTemporarily){
          if(ordersStatusBarTimeout) clearTimeout(ordersStatusBarTimeout);
          ordersStatusBarTimeout = setTimeout(()=>{ document.getElementById("ordersStatusBarInNotif").style.display = 'none'; }, 20000);
        }
      }

      // ======= ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (fetch /api/products) Ùˆ Ø§Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ======
      async function fetchProducts(){
        const grid = document.getElementById('productsGrid');
        if(!grid) return;
        grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px" id="productsLoader"><span class=\"loader\">ğŸ” Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</span></div>`;
        try{
          const res = await fetch('/api/products');
          if(!res.ok) throw new Error('Ø®Ø·Ø£ HTTP: '+res.status);
          const data = await res.json();
          let products = [];
          // Ø¯Ø¹Ù… Ø¹Ø¯Ø© Ø£Ø´ÙƒØ§Ù„ Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù€ API
          if(Array.isArray(data)) products = data;
          else if(data && Array.isArray(data.data)) products = data.data;
          else if(data && data.products && Array.isArray(data.products)) products = data.products;
          else products = [];

          if(products.length === 0){
            grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;color:#aaa">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
            return;
          }

          grid.innerHTML = '';
          // Ù†Ø¶ÙŠÙ Ø¨Ø·Ø§Ù‚Ø© Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
          products.forEach(p => {
            const pid = p.id || p.product_id || p._id || p.slug || p.code || (p.title && p.title.replace(/\s+/g,'_')) || Math.random().toString(36).slice(2,8);
            const title = p.title || p.name || p.product || p.label || 'Ù…Ù†ØªØ¬';
            const price = (p.price || (p.meta && p.meta.price) || p.cost || p.price_display || '') + '';
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<div style="text-align:center;">\n                <strong class=\"product-title\">${escapeHtml(title)}</strong>\n                <div class=\"product-price\">${escapeHtml(price)}</div>\n                <div style=\"margin-top:8px\">\n                  <button class=\"small-btn buy-btn\">Ø´Ø±Ø§Ø¡</button>\n                </div>\n              </div>`;
            card.querySelector('.buy-btn').addEventListener('click', ()=> onProductBuy(p));
            grid.appendChild(card);
          });
        }catch(err){
          console.error('fetchProducts error', err);
          grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px;color:#ff6b6b">Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${escapeHtml(err.message || err)}</div>`;
        }
      }

      function escapeHtml(s){ return String(s===null||s===undefined?'':s).replace(/[&<>\"]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]; }); }

      function onProductBuy(product){
        if(!ensureNotBlocked()) return;
        // Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø­Ù‚Ù„ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø·Ù„Ø¨Ù‡
        const defaultId = document.getElementById('idField')?.value || '';
        const playerId = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§ÙŠØ¯ÙŠ Ø£Ùˆ Ù…Ø¹Ø±Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ ${personalNumber}):`, defaultId) || '';
        const qtyStr = prompt('ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø© ØªØ±ÙŠØ¯ (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 1):','1') || '1';
        const qty = parseInt(qtyStr,10) || 1;
        createOrderRequest(product, qty, playerId);
      }

      async function createOrderRequest(product, qty, playerId){
        try{
          const productId = product.id || product.product_id || product._id || product.code || product.slug || product.title || product.name;
          if(!productId){ alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬.'); return; }
          const body = { qty: qty };
          if(playerId) body.playerId = playerId;

          const res = await fetch(`/api/newOrder/${encodeURIComponent(productId)}`, {
            method:'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body)
          });
          const data = await res.json();
          if(!res.ok){ console.warn('server returned not ok', data); alert('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨: ' + (data && data.error ? data.error : JSON.stringify(data))); return; }

          // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ù…ØªØ§Ø¨Ø¹ØªÙ‡ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          const orderId = Date.now();
          const order = {
            id: orderId,
            type: 'Ø·Ù„Ø¨ Ø¹Ø¨Ø± API',
            item: product.title || product.name || String(productId),
            qty, playerId, response: data,
            status: (data && (data.status || data.message)) || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            replied: false,
            telegramMessageId: null,
            createdAt: new Date().toISOString(),
            personalNumber: String(personalNumber)
          };
          addOrder(order);
          localStorage.setItem('lastOrderId', orderId);

          alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…. Ø±Ø§Ø¬Ø¹ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø§Ù„Ø©.');
          showReviewPage(orderId);
        }catch(e){ console.error('createOrderRequest error', e); alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨: ' + (e && e.message ? e.message : e)); }
      }

      // === ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„ÙŠ ===
      // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù†ÙØªØ­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      window.addEventListener('DOMContentLoaded', ()=>{
        showHome();
      });

      // --- Ø¨Ø§Ù‚ÙŠ Ø³ÙƒØ±Ø¨ØªØ§Øª Ø§Ù„ØµÙØ­Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ ÙƒØ§Ù†Øª (Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù‚ÙŠØ© ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹) ---

    </script>
  </body>
</html>
